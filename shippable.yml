# Language setting
language: node_js

#build_image: drydock/u12nod:prod

# Version number
node_js:
  - 0.11
  - 0.10
services:
  - cassandra

# The path for Xunit to output test reports
env:
  - XUNIT_FILE=shippable/testresults/result.xml

#install:
 # - source ~/.nvm/nvm.sh && nvm install 0.12
  #- node --version
  #- npm install
#  - . installMongo.sh
#  - cat /etc/mongod.conf
#  - sudo mongod --smallfiles &
#  - sleep 15
#  - mongo --eval 'db.collection.find()'

# Create directories for test and coverage reports
#before_script:
 # - mkdir -p shippable/testresults
  #- mkdir -p shippable/codecoverage

# Running the tests with grunt
#script:
 # - grunt

# Tell istanbul to generate a coverage report
#after_script:
 # - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  #- ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
build:   
  
  pre_ci_boot:
    image_name: shippable/minv2
    image_tag: latest
    pull: true
    options: '--privileged=true --net=bridge -e FOO=true -e BOO=false'

  ci:
    
    - echo "Hello, World!"
    - env
    - echo $PATH
    - reports --help
    - node --version
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - source ~/.nvm/nvm.sh && nvm install 0.12
    - node --version
    - npm install
    - ./node_modules/.bin/istanbul cover grunt -- -u tdd
    - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
    - grunt      

